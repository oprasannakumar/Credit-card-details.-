<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Secure Card Vault</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
<style>
:root { --primary:#2563eb; --bg:#f3f4f6; --container-bg:#fff; --text-main:#1f2937; --input-border:#d1d5db; --btn-ghost:#64748b; --danger:#dc2626; --success:#16a34a;}
body{font-family:Inter,sans-serif;background:var(--bg);margin:0;display:flex;align-items:center;justify-content:center;min-height:100vh;}
.container{width:calc(100% - 40px);max-width:380px;background:var(--container-bg);padding:2rem 1.5rem;border-radius:2rem;text-align:center;box-shadow:0 10px 25px rgba(0,0,0,0.05);}
h2{margin-top:0;margin-bottom:1.5rem;font-size:1.4rem;}
.credit-card{width:100%;aspect-ratio:1.58/1;border-radius:1.25rem;padding:1.2rem;margin:1rem 0;background:#111827;color:white;display:flex;flex-direction:column;justify-content:space-between;box-shadow:0 8px 20px rgba(0,0,0,0.2);}
.card-header{display:flex;justify-content:space-between;align-items:center;}
.card-chip{width:40px;height:28px;background:linear-gradient(135deg,#fbbf24,#d97706);border-radius:4px;}
.card-number{font-family:monospace;font-size:1.2rem;letter-spacing:2px;cursor:pointer;margin:auto 0;}
.card-footer{display:grid;grid-template-columns:2fr 1.2fr 0.8fr;gap:5px;text-align:left;font-size:0.8rem;}
.label{font-size:0.5rem;text-transform:uppercase;opacity:0.7;display:block;}
input,select{width:100%;padding:0.8rem;border-radius:0.75rem;margin:0.4rem 0;border:1px solid var(--input-border);font-size:1rem;}
.btn{width:100%;padding:0.8rem;border-radius:0.7rem;font-weight:600;cursor:pointer;border:none;margin-top:0.5rem;}
.btn-blue{background:var(--primary);color:white;}
.btn-green{background:var(--success);color:white;}
.btn-ghost{background:var(--btn-ghost);color:white;}
.btn-danger{background:var(--danger);color:white;}
.hidden{display:none;}
</style>
</head>
<body>

<div class="container">
<h2>Secure Card Vault</h2>

<div id="unlockSection">
<button class="btn btn-green" onclick="unlockWithBiometric()">Unlock with Biometrics</button>
</div>

<div id="mainContent" class="hidden">

<select id="cardSelector" onchange="handleSelection()"></select>
<div id="cardDisplay"></div>
<button class="btn btn-blue" onclick="toggleAddForm()">+ Add Card</button>

<div id="addForm" class="hidden">
<input type="hidden" id="editId">
<input type="text" id="nick" placeholder="Nickname">
<select id="type">
<optgroup label="RuPay">
<option value="RuPay Classic">RuPay Classic</option>
<option value="RuPay Platinum">RuPay Platinum</option>
<option value="RuPay Select">RuPay Select</option>
</optgroup>
<optgroup label="Visa">
<option value="Visa Classic">Visa Classic</option>
<option value="Visa Gold">Visa Gold</option>
<option value="Visa Platinum">Visa Platinum</option>
<option value="Visa Signature">Visa Signature</option>
<option value="Visa Infinite">Visa Infinite</option>
</optgroup>
<optgroup label="Mastercard">
<option value="Mastercard Standard">Mastercard Standard</option>
<option value="Mastercard Gold">Mastercard Gold</option>
<option value="Mastercard Platinum">Mastercard Platinum</option>
<option value="Mastercard World">Mastercard World</option>
<option value="Mastercard World Elite">Mastercard World Elite</option>
</optgroup>
</select>
<input type="tel" id="num" placeholder="Card Number">
<input type="text" id="name" placeholder="Cardholder Name">
<div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;">
<input type="text" id="exp" placeholder="MM/YY">
<input type="tel" id="cvv" placeholder="CVV">
</div>
<button class="btn btn-blue" onclick="saveCard()">Save</button>
<button class="btn btn-ghost" onclick="toggleAddForm()">Cancel</button>
</div>

<div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:5px;margin-top:1rem;">
<button class="btn btn-ghost" onclick="exportData()">Backup</button>
<button class="btn btn-ghost" onclick="document.getElementById('importFile').click()">Import</button>
<button class="btn btn-danger" onclick="location.reload()">Lock</button>
</div>
<input type="file" id="importFile" class="hidden" onchange="importData(this)">

</div>
</div>

<script>
let VAULT_KEY=null;

/* Utility */
function bufferToBase64(buffer){return btoa(String.fromCharCode(...new Uint8Array(buffer)));}
function base64ToBuffer(base64){return Uint8Array.from(atob(base64),c=>c.charCodeAt(0));}
function randomChallenge(){return window.crypto.getRandomValues(new Uint8Array(32));}

/* Vault Key */
function generateVaultKey(){const a=new Uint8Array(32);window.crypto.getRandomValues(a);return bufferToBase64(a);}
function initializeVault(){
if(!localStorage.getItem("vault_key")){
const key=generateVaultKey();
localStorage.setItem("vault_key",key);
localStorage.setItem("vault_data",CryptoJS.AES.encrypt("[]",key).toString());
}
}

/* WebAuthn */
async function registerBiometric(){
const publicKey={
challenge:randomChallenge(),
rp:{name:"Secure Card Vault"},
user:{id:randomChallenge(),name:"vault-user",displayName:"Vault User"},
pubKeyCredParams:[{type:"public-key",alg:-7}],
authenticatorSelection:{authenticatorAttachment:"platform",userVerification:"required"},
timeout:60000
};
const credential=await navigator.credentials.create({publicKey});
localStorage.setItem("vault_bio_id",bufferToBase64(credential.rawId));
initializeVault();
}

async function unlockWithBiometric(){
let storedId=localStorage.getItem("vault_bio_id");
if(!storedId){await registerBiometric();storedId=localStorage.getItem("vault_bio_id");}
const publicKey={
challenge:randomChallenge(),
allowCredentials:[{id:base64ToBuffer(storedId),type:"public-key",transports:["internal"]}],
userVerification:"required",
timeout:60000
};
await navigator.credentials.get({publicKey});
VAULT_KEY=localStorage.getItem("vault_key");
document.getElementById("unlockSection").classList.add("hidden");
document.getElementById("mainContent").classList.remove("hidden");
updateDropdown();
}

/* Vault Logic */
function getCards(){
const d=localStorage.getItem("vault_data");
if(!d||!VAULT_KEY)return[];
return JSON.parse(CryptoJS.AES.decrypt(d,VAULT_KEY).toString(CryptoJS.enc.Utf8));
}
function saveCard(){
const editId=document.getElementById('editId').value;
const card={
id:editId?parseInt(editId):Date.now(),
nick:nick.value,
type:type.value,
num:num.value,
name:name.value,
exp:exp.value,
cvv:cvv.value
};
let cards=getCards();
if(editId){cards[cards.findIndex(c=>c.id==editId)]=card;}
else{cards.push(card);}
localStorage.setItem("vault_data",CryptoJS.AES.encrypt(JSON.stringify(cards),VAULT_KEY).toString());
toggleAddForm();updateDropdown();
}
function deleteCard(id){
let cards=getCards().filter(c=>c.id!=id);
localStorage.setItem("vault_data",CryptoJS.AES.encrypt(JSON.stringify(cards),VAULT_KEY).toString());
updateDropdown();handleSelection();
}
function updateDropdown(){
const s=document.getElementById("cardSelector");
const c=getCards();
s.innerHTML='<option value="">Select</option>'+c.map(x=>`<option value="${x.id}">${x.nick}</option>`).join('');
}
function handleSelection(){
const id=document.getElementById("cardSelector").value;
if(!id){cardDisplay.innerHTML="";return;}
const card=getCards().find(c=>c.id==id);
cardDisplay.innerHTML=`
<div class="credit-card">
<div class="card-header"><div class="card-chip"></div><div>${card.type}</div></div>
<div class="card-number" onclick="navigator.clipboard.writeText('${card.num}')">${card.num}</div>
<div class="card-footer">
<div><span class="label">Holder</span><span onclick="navigator.clipboard.writeText('${card.name}')">${card.name}</span></div>
<div><span class="label">Exp</span><span onclick="navigator.clipboard.writeText('${card.exp}')">${card.exp}</span></div>
<div><span class="label">CVV</span><span onclick="navigator.clipboard.writeText('${card.cvv}')">•••</span></div>
</div>
</div>
<button class="btn btn-danger" onclick="deleteCard(${card.id})">Delete</button>
`;
}
function toggleAddForm(){addForm.classList.toggle("hidden");}

/* Backup */
function exportData(){
const blob=new Blob([JSON.stringify({
data:localStorage.getItem("vault_data"),
key:localStorage.getItem("vault_key")
})],{type:"text/plain"});
const a=document.createElement("a");
a.href=URL.createObjectURL(blob);
a.download="vault_backup.txt";
a.click();
}

function importData(input){
const reader=new FileReader();
reader.onload=e=>{
const j=JSON.parse(e.target.result);

localStorage.setItem("vault_data",j.data);
localStorage.setItem("vault_key",j.key);

// Remove old biometric reference
localStorage.removeItem("vault_bio_id");

alert("Backup restored. Please enable biometrics again.");
location.reload();
};
reader.readAsText(input.files[0]);
}

</script>
</body>
</html>
